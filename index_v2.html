<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8"/>
    <title>Stefan_Reisekarte_FINAL_OPTIMIERT_MIT_LABELS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <link rel="stylesheet" href="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Widgets/widgets.css">
    
    <style>
        html, body, #cesiumContainer { height: 100%; margin:0; padding:0; overflow:hidden; }
        
        /* CSS f√ºr die manuelle Legende */
        #route-legend {
            position: absolute; 
            bottom: 20px; 
            left: 20px; 
            z-index: 1000; 
            background: rgba(255, 255, 255, 0.9); 
            padding: 10px; 
            border-radius: 5px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-family: sans-serif;
            font-size: 13px;
        }
        #route-legend .dot { 
            display: inline-block; 
            width: 10px; 
            height: 10px; 
            border-radius: 50%; 
            margin-right: 5px; 
            vertical-align: middle;
        }
        .cesium-widget-credits { 
            display: none !important; 
        } 
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>

    <div id="route-legend">
        <b>Reiseroute 2025/2026</b><br>
        <div style="margin-top: 5px;">
            <span class="dot" style="background: #d4af37;"></span> Thailand
        </div>
        <div>
            <span class="dot" style="background: #2e8b57;"></span> Vietnam
        </div>
        <div>
            <span class="dot" style="background: #c62828;"></span> Japan
        </div>
        <div>
            <span class="dot" style="background: #666666;"></span> An-/R√ºckreise
        </div>
    </div>

    <script src="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Cesium.js"></script>
    
    <script>
        const CESIUM_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0YTkzZjgyYy1lNjY3LTRjYzAtYWYzMzAtMjliNjg5MDJmYTYxIiwiaWQiOjM1MDA0NywiaWF0IjoxNzYwMzYxODM5fS5hcDN6QU1GX0s4RVhhZTFiWmRyRHR6Ujhhc3c1TmxsNkY0cmRrdkhvWVk";
        Cesium.Ion.defaultAccessToken = CESIUM_TOKEN;

        // --- KONSTANTEN ---
        const colors = {
            "Thailand": Cesium.Color.fromCssColorString("#d4af37"),
            "Vietnam": Cesium.Color.fromCssColorString("#2e8b57"),
            "Japan": Cesium.Color.fromCssColorString("#c62828"),
            "Anreise": Cesium.Color.fromCssColorString("#666666"), 
            "Rueckflug": Cesium.Color.fromCssColorString("#666666")
        };
        const defaultColor = Cesium.Color.fromCssColorString("#666666");

        // H√∂heneinstellungen
        const MARKER_HEIGHT_METERS = 200;     // Punkte liegen auf 200 m
        const ARC_HEIGHT_METERS = 300;      // Flugb√∂gen liegen auf 300 m

        // STATUS-ANZEIGE: HIER MUSST DU DEN INDEX MANUELL √ÑNDERN
        const CURRENT_STATION_INDEX = -1; // 0 = M√ºnchen (Abflug), 15 = Ha Giang (Tag 3)
        // ENDE STATUS-ANZEIGE

        // Stationsliste (Unver√§ndert)
        const stations = [
            { name: "M√ºnchen (Abflug)", lat: 48.340993848205116, lon: 11.776813638446827, phase: "Anreise", date: "06.11.2025", note: "Abflug MUC 21:25" },
            { name: "Dubai (Zwischenstopp)", lat: 25.2532, lon: 55.2798, phase: "Anreise", date: "07.11.2025", note: "Zwischenstopp DXB (nur Pfad)" }, 
            { name: "Bangkok (Tag 1)", lat: 13.763240766438173, lon: 100.49687501809402, phase: "Thailand", date: "08.11.2025", note: "Bangkok - K√∂nigspalast & Tempel" },
            { name: "Bangkok (Tag 2)", lat: 13.799670117646631, lon: 100.55058974890065, phase: "Thailand", date: "09.11.2025", note: "Bangkok - M√§rkte & Kultur" },
            { name: "Bangkok (Tag 3)", lat: 13.749884779840412, lon: 100.49149841021426, phase: "Thailand", date: "10.11.2025", note: "Tag in Bangkok ¬∑ Abends Reise nach Chiang Mai" },
            { name: "Chiang Mai (Ankunft)", lat: 18.7883, lon: 98.9853, phase: "Thailand", date: "11.11.2025", note: "Chiang Mai - erster Abend" },
            { name: "Chiang Mai (Tag 1)", lat: 18.7883, lon: 98.9853, phase: "Thailand", date: "12.11.2025", note: "Chiang Mai - Tempel, Altstadt" },
            { name: "Pai (Ausflug)", lat: 19.3591, lon: 98.4371, phase: "Thailand", date: "13.11.2025", note: "Tagesausflug zur Pai Canyon / Reisterrassen" }, 
            { name: "Chiang Rai (Ausflug)", lat: 19.9056, lon: 99.8306, phase: "Thailand", date: "14.11.2025", note: "Tagesausflug zum Wei√üen Tempel (Wat Rong Khun)" }, 
            { name: "Chiang Mai (Tag 2)", lat: 18.7883, lon: 98.9853, phase: "Thailand", date: "15.11.2025", note: "Chiang Mai - Doi Inthanon" },
            { name: "Chiang Mai (Abreisevorbereitung)", lat: 18.7883, lon: 98.9853, phase: "Thailand", date: "16.11.2025", note: "Letzte Erledigungen" },
            { name: "Reise nach Hanoi", lat: 18.7883, lon: 98.9853, phase: "Anreise", date: "17.11.2025", note: "Flug CNX ‚Üí HAN (geplant)(nur Pfad)" },
            { name: "Hanoi - Vorbereitung", lat: 21.0285, lon: 105.8542, phase: "Vietnam", date: "18.11.2025", note: "Hanoi - Vorbereitung Ha Giang Loop" },
            { name: "Ha Giang - Loop Start", lat: 22.7900, lon: 104.9850, phase: "Vietnam", date: "19.11.2025", note: "Start Ha Giang Loop (Tag 1)" },
            { name: "Ha Giang - Loop (Tag 2 / Quy·∫øt Ti·∫øn)", lat: 23.1300, lon: 105.1000, phase: "Vietnam", date: "20.11.2025", note: "Ha Giang Loop (Quy·∫øt Ti·∫øn / Dong Van)" }, 
            { name: "Ha Giang - Loop (Tag 3 / M√®o V·∫°c)", lat: 23.2300, lon: 105.4200, phase: "Vietnam", date: "21.11.2025", note: "Ha Giang Loop (M√®o V·∫°c / Ma Pi Leng Pass)" }, 
            { name: "Ha Giang - Loop Ende", lat: 22.7900, lon: 104.9850, phase: "Vietnam", date: "22.11.2025", note: "Ende Ha Giang Loop (Zur√ºck nach Ha Giang)" },
            { name: "Hanoi - Erholung", lat: 21.0285, lon: 105.8542, phase: "Vietnam", date: "23.11.2025", note: "Erholung in Hanoi" },
            { name: "Halong-Bucht - Kreuzfahrt (Tag 1)", lat: 20.9101, lon: 107.1839, phase: "Vietnam", date: "24.11.2025", note: "Halong-Bucht - Kreuzfahrt (Tag 1)" },
            { name: "Halong-Bucht - R√ºckkehr", lat: 20.9101, lon: 107.1839, phase: "Vietnam", date: "25.11.2025", note: "Halong-Bucht - R√ºckkehr" },
            { name: "Tagesausflug Ninh Binh", lat: 20.2500, lon: 105.9745, phase: "Vietnam", date: "26.11.2025", note: "Tam Coc / Mua Cave" },
            { name: "Hanoi - normaler Tag", lat: 21.0285, lon: 105.8542, phase: "Vietnam", date: "27.11.2025", note: "Hanoi - Erkundung" },
            { name: "Hanoi - Abreisevorbereitung", lat: 21.0285, lon: 105.8542, phase: "Vietnam", date: "28.11.2025", note: "Vorbereitung Weiterreise" },
            { name: "Reise nach Ho-Chi-Minh-Stadt", lat: 21.0285, lon: 105.8542, phase: "Anreise", date: "29.11.2025", note: "Inlandsflug nach SGN (nur Pfad)" },
            { name: "Ho-Chi-Minh-Stadt", lat: 10.7769, lon: 106.7009, phase: "Vietnam", date: "30.11.2025", note: "HCMC - Stadt & Leben" },
            { name: "Mekong-Delta (Tagesausflug)", lat: 10.0452, lon: 105.7715, phase: "Vietnam", date: "01.12.2025", note: "Mekong-Delta Tagestour" },
            { name: "Ho-Chi-Minh-Stadt - normal", lat: 10.7769, lon: 106.7009, phase: "Vietnam", date: "02.12.2025", note: "HCMC - Freizeit" },
            { name: "HCMC - Abreisevorbereitung", lat: 10.7769, lon: 106.7009, phase: "Vietnam", date: "03.12.2025", note: "Packen, Checklisten" },
            { name: "HCMC - Puffertag", lat: 10.7769, lon: 106.7009, phase: "Vietnam", date: "04.12.2025", note: "Reserve / Puffer" },
            { name: "HCMC (Abflug nach Tokio)", lat: 10.7629, lon: 106.6606, phase: "Anreise", date: "05.12.2025", note: "Nachtflug SGN 23:55 ‚Üí NRT (nur Pfad)" }, 
            { name: "Tokio (Ankunft NRT)", lat: 35.7719, lon: 140.3929, phase: "Japan", date: "06.12.2025", note: "Ankunft NRT 07:35 ¬∑ Asakusa / Ueno" },
            { name: "Tokio - Tag 2", lat: 35.6762, lon: 139.6503, phase: "Japan", date: "07.12.2025", note: "Tokio erkunden" },
            { name: "Nikk≈ç (Tagesausflug)", lat: 36.7199, lon: 139.6983, phase: "Japan", date: "08.12.2025", note: "Toshogu-Schrein & Natur" },
            { name: "Nagano / Yudanaka", lat: 36.6486, lon: 138.1948, phase: "Japan", date: "09.12.2025", note: "Jigokudani / Schneeaffen" },
            { name: "Matsumoto", lat: 36.2381, lon: 137.9717, phase: "Japan", date: "10.12.2025", note: "Matsumoto-Schloss" },
            { name: "Takayama", lat: 36.1456, lon: 137.2520, phase: "Japan", date: "11.12.2025", note: "Altstadt & Markt" },
            { name: "Shirakawa-go", lat: 36.2706, lon: 136.8996, phase: "Japan", date: "12.12.2025", note: "Gassho-Zukuri Bauernh√§user" },
            { name: "Kanazawa", lat: 36.5613, lon: 136.6562, phase: "Japan", date: "13.12.2025", note: "Kenroku-en Garten, Samuraiviertel" },
            { name: "Kanazawa / Noto (optional)", lat: 37.4560, lon: 137.3618, phase: "Japan", date: "14.12.2025", note: "Noto-Halbinsel (K√ºste) optional" },
            { name: "Kyoto (Teil I)", lat: 35.0116, lon: 135.7681, phase: "Japan", date: "15.12.2025", note: "Kyoto - Fushimi Inari, Gion" },
            { name: "Kyoto (Teil II)", lat: 35.0116, lon: 135.7681, phase: "Japan", date: "16.12.2025", note: "Kyoto - Philosophenweg & Tempel" },
            { name: "Nara (Tagesausflug)", lat: 34.6851, lon: 135.8048, phase: "Japan", date: "17.12.2025", note: "Todai-ji & Hirschpark" },
            { name: "Kyoto ‚Üí Osaka (Abend)", lat: 34.6937, lon: 135.5023, phase: "Japan", date: "18.12.2025", note: "Abendliche Fahrt nach Osaka" },
            { name: "Osaka", lat: 34.6937, lon: 135.5023, phase: "Japan", date: "19.12.2025", note: "Dotonbori, Streetfood" },
            { name: "Tokio (R√ºckkehr)", lat: 35.6762, lon: 139.6503, phase: "Japan", date: "20.12.2025", note: "Shinkansen zur√ºck nach Tokio" },
            { name: "Tokio - Abschiedstag", lat: 35.6762, lon: 139.6503, phase: "Japan", date: "21.12.2025", note: "Letzte Eink√§ufe & Packen" },
            { name: "Tokio (Abflug HND)", lat: 35.5494, lon: 139.7798, phase: "Japan", date: "22.12.2025", note: "Abflug HND 21:00 ‚Üí MUC (nur Pfad)" }, 
            { name: "Peking (Zwischenstopp)", lat: 39.9042, lon: 116.4074, phase: "Rueckflug", date: "22.12.2025", note: "Zwischenstopp PEK (nur Pfad)" },
            { name: "M√ºnchen (Ankunft)", lat: 48.36958861586051, lon: 11.811849615397932, phase: "Rueckflug", date: "23.12.2025", note: "Ankunft MUC" }
        ];


        // --- CESIUM INITIALISIERUNG ---
        const viewer = new Cesium.Viewer('cesiumContainer', {
            scene: {
                fxaa: true
            },
            baseLayerPicker: true, 
            baseLayer: false,
            terrainProvider: new Cesium.EllipsoidTerrainProvider(), 
            animation: false,
            timeline: false,
            sceneModePicker: true,
            navigationHelpButton: true,
            infoBox: true, 
            fullscreenButton: true,
        });

        viewer.imageryLayers.removeAll();
        viewer.imageryLayers.addImageryProvider(
            new Cesium.OpenStreetMapImageryProvider({
                url: 'https://a.tile.openstreetmap.org/', 
                fileExtension: 'png',
                credit: '¬© OpenStreetMap contributors' 
            })
        );
        
        const entities = viewer.entities;
        let previousPosition = null;
        let previousPhase = null;

        // --- HINZUF√úGEN VON ENTIT√ÑTEN (PUNKTE & LINIEN) ---
        stations.forEach((s, idx) => {
            const phase = s.phase in colors ? s.phase : "Anreise";
            const currentColor = colors[phase];
            
            // Setze die Position auf 200 m √ºber dem Boden
            const currentPosition = Cesium.Cartesian3.fromDegrees(s.lon, s.lat, MARKER_HEIGHT_METERS);
            
            
            // MARKER HINZUF√úGEN (Nur f√ºr relevante Punkte)
            if (!s.note.includes("(nur Pfad)")) {
                
                const description = `
                    <h3>${s.name}</h3>
                    <p>
                        <small>Phase: ${s.phase}</small><br>
                        <b>Datum: ${s.date}</b><br>
                        <i>${s.note}</i>
                    </p>
                    <hr style='margin:6px 0'>
                    <small>Reihenfolge: ${idx+1} / ${stations.length}</small>
                `;

                // 1. Der runde Punkt (Point Entity)
                entities.add({
                    position: currentPosition,
                    point: {
                        pixelSize: 15,
                        color: currentColor,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                    },
                    description: description,
                    name: s.name
                });
                
                // 3. NEU: Aktueller Ort Label
                if (idx === CURRENT_STATION_INDEX) {
                    entities.add({
                        position: currentPosition,
                        name: `Aktueller Ort: ${s.name}`,
                        label: {
                            text: `üìç HIER BIN ICH! (${s.date})`,
                            font: '18pt sans-serif',
                            fillColor: Cesium.Color.WHITE,
                            backgroundColor: currentColor.withAlpha(0.8), 
                            showBackground: true,
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                            outlineWidth: 2,
                            verticalOrigin: Cesium.VerticalOrigin.BOTTOM, 
                            pixelOffset: new Cesium.Cartesian2(0, -30) // H√∂her √ºber dem Punkt
                        }
                    });
                }

            } // ENDE: if (!s.note.includes("(nur Pfad)"))

            // SEGMENT LINIE HINZUF√úGEN
            if (previousPosition) {
                const i = idx - 1; // Index f√ºr den Startpunkt des Segments
                const isFlightSegment = (s.phase === "Anreise" || s.phase === "Rueckflug" || stations[i].phase === "Anreise");
                
                const segmentColor = isFlightSegment ? defaultColor : currentColor;

                // Gestrichelte Linie f√ºr Fl√ºge
                const lineStyle = isFlightSegment 
                    ? new Cesium.PolylineDashMaterialProperty({
                        color: segmentColor, 
                        dashLength: 10.0,
                    }) 
                    : segmentColor;

                if (isFlightSegment) {
                    // Erzeuge die Positionen MIT der erh√∂hten Bogen-H√∂he (300 km)
                    const startArcPosition = Cesium.Cartesian3.fromDegrees(stations[i].lon, stations[i].lat, ARC_HEIGHT_METERS);
                    const endArcPosition = Cesium.Cartesian3.fromDegrees(stations[i+1].lon, stations[i+1].lat, ARC_HEIGHT_METERS);

                    entities.add({
                        name: `Flug: ${stations[i].name} ‚Üí ${s.name}`,
                        polyline: {
                            positions: [startArcPosition, endArcPosition],
                            width: 3,
                            material: lineStyle,
                            arcType: Cesium.ArcType.GEODESIC, // Echter Bogen
                            clampToGround: false
                        }
                    });
                } else {
                    // Normale Boden-Linie auf 1km H√∂he
                     entities.add({
                        name: `Boden: ${stations[i].name} ‚Üí ${s.name}`,
                        polyline: {
                            positions: [previousPosition, currentPosition],
                            width: 4,
                            material: lineStyle,
                            arcType: Cesium.ArcType.NONE,
                            clampToGround: false
                        }
                    });
                }
            }
            
            previousPosition = currentPosition;
            previousPhase = s.phase;
        });






// --- KAMERA-FLUG (ZOOM) ---

// 1. NEU: DEFINIERE EINE GLOBALE STARTPOSITION
// Position: Zentralasien / Himalaya (L√§nge/Breite)
// H√∂he: 10.000 km (zeigt die ganze Erde)
const globalStartDestination = Cesium.Cartesian3.fromDegrees(80.0, 35.0, 10000000.0); 

const relevantStations = stations.filter(s => !s.note.includes("(nur Pfad)"));

// Hier bleibt deine Berechnung f√ºr das Rechteck der gesamten Route (Zielort)
const rect = Cesium.Rectangle.fromDegrees(
    Math.min(...relevantStations.map(s => s.lon)) + 50,
    Math.min(...relevantStations.map(s => s.lat)) - 10,
    Math.max(...relevantStations.map(s => s.lon)) + 5,
    Math.max(...relevantStations.map(s => s.lat)) + 5
);

// Der tats√§chliche Zielort bleibt gleich (entweder aktuelle Station ODER die gesamte Route)
const finalTargetDestination = (CURRENT_STATION_INDEX >= 0 && !stations[CURRENT_STATION_INDEX].note.includes("(nur Pfad)")) 
    ? Cesium.Cartesian3.fromDegrees(stations[CURRENT_STATION_INDEX].lon, stations[CURRENT_STATION_INDEX].lat, 1000000)
    : rect;

viewer.camera.flyTo({
    // Starte von der vordefinierten globalen Position
    destination: finalTargetDestination, // Dies steuert den ENDPUNKT des Flugs
    duration: 5, // L√§ngere Flugdauer f√ºr dramatischen Effekt
    orientation: {
        // Starte mit dem Blick in Richtung Norden (0) oder leicht schr√§g (z.B. 45 Grad)
		heading: Cesium.Math.toRadians(0),   // ‚¨ÖÔ∏è Dies ist die Blickrichtung (Azimut)
        pitch: Cesium.Math.toRadians(-90),   // ‚¨ÖÔ∏è Dies ist die Neigung (H√∂henwinkel)
        roll: 0.0
    },
    // F√ºge eine Kameraposition VOR dem FlyTo hinzu, um einen echten √úbergang zu sehen
    // Ansonsten startet der Flug direkt vom Zielort aus.
    // Setze die Kamera zuerst an die globale Position
    'start' : globalStartDestination, 
    
    complete: function() {
        viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
    }
});





        
    </script>
</body>
</html>